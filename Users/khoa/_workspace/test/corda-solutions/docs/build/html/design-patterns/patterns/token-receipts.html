<!-- If you edit this, then please make the same changes to layout_for_doc_website.html, as that is used for the web
     doc site generation which we put analytics tracking on to identify any potential problem pages  -->


<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Token Receipts Pattern &mdash; Corda Solutions Site October 2018 documentation</title><link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CorDapp Anti-Patterns" href="../antipatterns/antipatterns-overview.html" />
    <link rel="prev" title="Receipts Pattern" href="receipts.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

            <a href="../../index.html" class="icon icon-home"> Corda Solutions Site
          </a>
              <div class="version">
                October 2018
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Business Networks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../business-networks/intro.html">Corda Business Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../business-networks/what-is-a-business-network.html">What is a Business Network?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../business-networks/how-do-business-networks-start.html">How Do Business Networks Start?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../business-networks/how-do-business-networks-start.html#top-down-business-led">Top-Down (Business-Led)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../business-networks/how-do-business-networks-start.html#bottom-up-technology-led">Bottom-Up (Technology-Led)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../business-networks/how-do-business-networks-start.html#adoptive">Adoptive</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../business-networks/roles-and-responsibilities.html">Roles and Responsibilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../business-networks/roles-and-responsibilities.html#business-network-governor-bng">Business Network Governor (BNG)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../business-networks/roles-and-responsibilities.html#business-network-operator-bno">Business Network Operator (BNO)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../business-networks/roles-and-responsibilities.html#business-network-user-bnu">Business Network User (BNU)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../business-networks/business-network-operator-node.html">Business Network Operator Node</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../business-networks/business-network-operator-node.html#business-network-operator-services">Business Network Operator Services</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-operator-node.html#membership-management">Membership Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-operator-node.html#master-data-management">Master Data Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-operator-node.html#authorisation">Authorisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-operator-node.html#monitoring-reporting">Monitoring &amp; Reporting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-operator-node.html#announcements-signaling">Announcements &amp; Signaling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-operator-node.html#software-distribution">Software Distribution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../business-networks/interoperability.html">Interoperability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../business-networks/business-network-playbook/intro.html">Business Network Playbook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../business-networks/business-network-playbook/structure.html">S. Structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/structure.html#s-1-define-business-network-mission">S.1. Define Business Network Mission</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/structure.html#s-2-assign-business-network-roles">S.2. Assign Business Network Roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/structure.html#s-3-define-the-governance-body-model">S.3. Define the Governance Body Model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html">G. Governance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-1-describe-participants">G.1. Describe Participants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-2-define-the-asset-model">G.2. Define the Asset Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-2-define-the-business-process">G.2. Define the Business Process</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-4-outline-legal-and-regulatory-needs">G.4. Outline Legal and Regulatory Needs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-5-establish-the-network-financial-model">G.5. Establish the Network Financial Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-6-establish-data-privacy-policies">G.6. Establish Data Privacy Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-7-establish-data-retention-policies">G.7. Establish Data Retention policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-8-establish-data-resiliency-and-system-availability-policies">G.8. Establish Data Resiliency and System Availability Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-9-assert-data-and-or-processing-standards">G.9. Assert Data and/or Processing Standards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-10-establish-transaction-validation-policies">G.10. Establish Transaction Validation Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-11-establish-dispute-management-policies">G.11. Establish Dispute Management Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-12-establish-on-boarding-policies">G.12. Establish On-boarding Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-13-establish-off-boarding-policies">G.13. Establish Off-boarding Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-14-establish-inter-network-policies">G.14. Establish Inter-Network Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-15-define-performance-slas">G.15. Define Performance SLAs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-16-establish-change-management-policies">G.16. Establish Change Management Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-16-1-business-network-role-changes">G.16.1. Business Network Role Changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-16-2-business-network-legal-agreement-changes">G.16.2. Business Network Legal Agreement Changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-16-3-corda-platform-change-management-rules">G.16.3. Corda Platform Change Management Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/governance.html#g-16-4-cordapp-change-management-rules">G.16.4. CorDapp Change Management Rules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../business-networks/business-network-playbook/operations.html">O. Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/operations.html#o-1-devise-node-configuration">O.1. Devise Node Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/operations.html#o-2-notary-configuration">O.2. Notary Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/operations.html#o-3-oracle-configuration">O.3. Oracle Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/operations.html#o-4-create-change-management-procedures">O.4. Create change management procedures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/operations.html#o-5-establish-operational-times">O.5. Establish Operational Times</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/operations.html#o-6-establish-monitoring-metrics">O.6. Establish monitoring metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/operations.html#o-7-define-audit-report-and-documentation-requirements">O.7. Define audit, report and documentation requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/operations.html#o-8-define-the-network-support-parameters">O.8. Define the network support parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../business-networks/business-network-playbook/operations.html#o-9-define-data-retention-and-pruning-procedures">O.9. Define Data Retention and Pruning Procedures</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Software Designs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../designs/business-networks-membership-service.html">Business Network Membership Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../designs/business-networks-membership-service.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/business-networks-membership-service.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/business-networks-membership-service.html#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/business-networks-membership-service.html#scope">Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/business-networks-membership-service.html#timeline">Timeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/business-networks-membership-service.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/business-networks-membership-service.html#assumptions">Assumptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/business-networks-membership-service.html#target-solution">Target solution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../designs/business-networks-membership-service.html#on-boarding">On-boarding</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../designs/business-networks-membership-service.html#request">Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../designs/business-networks-membership-service.html#activation">Activation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../designs/business-networks-membership-service.html#revocation">Revocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../designs/business-networks-membership-service.html#metadata-updates">Metadata updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../designs/business-networks-membership-service.html#membership-list-snapshot">Membership list snapshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../designs/business-networks-membership-service.html#membership-list-distribution">Membership list distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../designs/business-networks-membership-service.html#membership-verification">Membership verification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/business-networks-membership-service.html#api-extension-points">API extension points</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../designs/ledger-synchronisation-service.html">Ledger Synchronisation Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../designs/ledger-synchronisation-service.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/ledger-synchronisation-service.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/ledger-synchronisation-service.html#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/ledger-synchronisation-service.html#scope">Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/ledger-synchronisation-service.html#timeline">Timeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/ledger-synchronisation-service.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/ledger-synchronisation-service.html#assumptions">Assumptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/ledger-synchronisation-service.html#target-solution">Target solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../designs/ledger-synchronisation-service.html#api-extension-points">API extension points</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">CorDapp Design Language</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../corda-modelling-notation/overview/overview-overview.html">Overview of CDL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/overview/overview-whycdl.html">Why CorDapp Design Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/overview/overview-aims.html">Aims of CorDap Design Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/overview/overview-views.html">CorDapp Design Language Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/overview/overview-privacy.html">Analysing Privacy in CDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/overview/overview-complexity.html">Managing Complexity with CDL</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../corda-modelling-notation/views/views-overview.html">CDL Views</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/views/views-common-concepts.html">Common Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-common-concepts.html#defining-terms">Defining Terms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-common-concepts.html#representing-states">Representing States</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html">State Machine (Ledger)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#analogy-to-a-finite-state-machine">Analogy to a Finite State Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#basic-model">Basic model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#introducing-constraints">Introducing Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#transitions-constraints">Transitions Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#state-level-constraints">State Level Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#transaction-level-constraints">Transaction Level Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#required-signers-constraints">Required Signers Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#visibility-constraints">Visibility Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#multiplicity-constraints">Multiplicity Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#mapping-to-the-code">Mapping to the code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-machine.html#putting-it-together">Putting it together</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-evolution.html">State Evolution (Ledger)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-evolution.html#basic-state-evolution-diagram">Basic State Evolution Diagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-evolution.html#reference-state">Reference State</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-evolution.html#explicit-transactions">Explicit Transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-evolution.html#branching-transitions">Branching Transitions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/views/views-state-instance.html">States Instance (Ledger)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/views/views-bpmn.html">BPMN (Orchestration)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/views/views-transaction-instance.html">Transaction Instance (Orchestration)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/views/views-flow-sequence.html">Flow Sequence (Orchestration)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../corda-modelling-notation/high-level-architecture/arch-overview.html">High Level Architecture Views</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/high-level-architecture/arch-high_level_process.html">High Level Process Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/high-level-architecture/arch-corda-network.html">High Level Corda Network</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../corda-modelling-notation/privacy/privacy-overview.html">Analysing Privacy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/privacy/privacy-why-model.html">Why Model Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/privacy/privacy-analysing.html">Analysing Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/privacy/privacy-expressing-requirements.html">Expressing Privacy Requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../corda-modelling-notation/complexity/complexity-overview.html">Managing Complexity</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/complexity/complexity-flow-coupling.html">Flow Level Coupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/complexity/complexity-commands-coupling.html">Coupling Via Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/complexity/complexity-stateref-coupling.html">Coupling to a State Instance via StateRefs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../corda-modelling-notation/complexity/complexity-linearid-coupling.html">Coupling to a State’s Evolution via Linear Id</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Design Patterns</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="patterns-overview.html">CorDapp Design Patterns</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="receipts.html">Receipts Pattern</a><ul>
<li class="toctree-l3"><a class="reference internal" href="receipts.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="receipts.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="receipts.html#problem">Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="receipts.html#salient-factors">Salient Factors</a></li>
<li class="toctree-l3"><a class="reference internal" href="receipts.html#solution-walkthrough">Solution Walkthrough</a></li>
<li class="toctree-l3"><a class="reference internal" href="receipts.html#privacy-analysis">Privacy Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="receipts.html#extensions">Extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="receipts.html#things-to-consider-when-using-the-receipts-pattern">Things to Consider when using the Receipts pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="receipts.html#related-anti-patterns">Related Anti-patterns</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Token Receipts Pattern</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="#problem">Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#salient-factors">Salient Factors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solution-walkthrough">Solution Walkthrough</a></li>
<li class="toctree-l3"><a class="reference internal" href="#privacy-analysis">Privacy Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extensions-to-investigate">Extensions - to investigate</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../antipatterns/antipatterns-overview.html">CorDapp Anti-Patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../antipatterns/dual-roles-for-nodes.html">Dual roles for nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../antipatterns/check-ownership-of-all-input-states.html">Check ownership of all input states</a></li>
<li class="toctree-l2"><a class="reference internal" href="../antipatterns/unknown-commands.html">Unknown Commands</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Deployment Patterns</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/intro.html">Deployment options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../deployment/onprem/intro.html">On-Premises Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/bank-deploy-overview.html">Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/bank-deploy-overview.html#stakeholders">Stakeholders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/corda-node-architecture-components.html">Architecture Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/prerequisites-sizing.html">Prerequisites and Sizing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/prerequisites-sizing.html#corda-node-bridge-and-float">Corda Node, Bridge and Float</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/prerequisites-sizing.html#vault-database">Vault - Database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html">Installation and Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#non-ha-corda-node-bridge-float">Non HA Corda Node, Bridge, Float</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#ha-corda-node-bridge-float">HA Corda Node, Bridge, Float</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#java-8-installation-on-vm">Java 8 Installation on VM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#node-installation">Node Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#corda-firewall-pki-implementation">Corda Firewall PKI Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#explanation-of-pki-keys">Explanation of PKI Keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#generate-bridge-and-float-keystores">Generate Bridge and Float Keystores</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#bridge-installation">Bridge Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#float-installation">Float Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#corda-3-x-vs-corda-4-x-firewall-upgrade">Corda 3.x vs Corda 4.x Firewall Upgrade</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#port-policy-and-network-configuration">Port Policy and Network Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-firewall-deployment.html#proxy-configurations">Proxy Configurations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/node-registration.html">Node Registration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-registration.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/node-registration.html#registration-actions">Registration Actions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/start-components.html">Start Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/start-components.html#starting-float">Starting Float</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/start-components.html#starting-corda-node">Starting Corda Node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/start-components.html#starting-bridge">Starting Bridge</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/monitoring.html">Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/corda-network-access-details.html">Important Corda Network Details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/additional-info.html">Additional information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/concepts-background-information.html">Why Deploy Corda Firewall?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/flagdays.html">Corda Network Considerations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/kill-flow.html">Corda Flow Kill</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/kill-flow.html#how-to-kill-a-stuck-flow">How to Kill a stuck flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/kill-flow.html#how-to-create-stuck-flow">How to create stuck flow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/onprem/corda-health-checker.html">Corda Health Checker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/corda-health-checker.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/corda-health-checker.html#list-of-checks">List of Checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/corda-health-checker.html#report-format">Report Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/corda-health-checker.html#disabling-the-corda-health-survey-in-production">Disabling the Corda Health Survey in Production</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/corda-health-checker.html#running-the-corda-health-survey">Running the Corda Health Survey</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/onprem/corda-health-checker.html#example-failure-scenario">Example Failure Scenario</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../deployment/kubernetes/intro.html">Corda Kubernetes Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/kubernetes/considerations.html">Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/kubernetes/architecture-overview.html">Architecture overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/architecture-overview.html#architecture-explanation">Architecture explanation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/architecture-overview.html#demilitarized-zone-dmz">Demilitarized Zone (DMZ)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/architecture-overview.html#corda-firewall-bridge-float">Corda Firewall (Bridge &amp; Float)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/architecture-overview.html#socks-and-http-proxies">SOCKS and HTTP Proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/architecture-overview.html#kubernetes-cluster">Kubernetes Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/architecture-overview.html#connections-communication-protocols">Connections &amp; Communication Protocols</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/architecture-overview.html#connection-sequence">Connection Sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/architecture-overview.html#internal-kubernetes-cluster-details">Internal Kubernetes Cluster Details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/kubernetes/prerequisites.html">Corda Kubernetes Deployment Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/prerequisites.html#setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/prerequisites.html#docker-image-generation">Docker image generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/prerequisites.html#public-key-infrastructure-pki-generation">Public Key Infrastructure (PKI) generation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../deployment/kubernetes/corda-kubernetes-deployment.html">Corda Kubernetes Deployment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/corda-kubernetes-deployment.html#registration-certificate-generation">Registration / Certificate Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/corda-kubernetes-deployment.html#cordapps">CorDapps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/corda-kubernetes-deployment.html#deployment">Deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../deployment/kubernetes/corda-kubernetes-deployment.html#execution-and-testing">Execution and testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently asked questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq.html#what-is-this-site-for">What is this site for?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq.html#where-did-all-the-content-come-from">Where did all the content come from?</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Corda Solutions Site</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="patterns-overview.html">CorDapp Design Patterns</a></li>
      <li class="breadcrumb-item active">Token Receipts Pattern</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/design-patterns/patterns/token-receipts.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="token-receipts-pattern">
<h1>Token Receipts Pattern</h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Status:</th><td class="field-body">Peer reviewed</td>
</tr>
<tr class="field-even field"><th class="field-name">Implemented:</th><td class="field-body">No</td>
</tr>
</tbody>
</table>
<div class="section" id="summary">
<h2>Summary</h2>
<p>Token receipts pattern can be used where evidence of an AssetState transition (change of owner) is required to enable a DependentState transition within a separate Transaction, specifically where:</p>
<blockquote>
<div><ul class="simple">
<li>Each set of AssetState transitions within a single Transaction should enable only one DependentState transition, no double spends.</li>
<li>Being a participant on the AssetState chain does not give the ability to resolve the DependentState Transactions.</li>
<li>Being a participant on a DependentState Transaction does not giver the ability to resolve details on other DependentState Transactions.</li>
<li>The AssetState uses Confidential identities to preserve privacy on the AssetState chain</li>
</ul>
</div></blockquote>
<p>The Token Receipts Pattern is an extension of the Receipts pattern, where the EnablerState is a fungible/ ownable AssetState.</p>
</div>
<div class="section" id="context">
<h2>Context</h2>
<p>Often a Ledger transition is contingent on an asset movement. For example, A bond ownership change may be contingent on a cash token changing ownership.</p>
</div>
<div class="section" id="problem">
<h2>Problem</h2>
<p>One way of implementing this dependency is to put both transitions into the same Transaction. However, this has a potential privacy problem. in the Bond for Cash example, if that cash is subsequently used in an other transactions, the participants of the subsequent transaction will be able to resolve the details of the original transaction. This is unlikely to be acceptable, especially if the two transactions involve competing actors</p>
<p>Note, if the only confidential information in the states are the identities of the participants then Confidential Identities can be used instead of the receipts pattern.</p>
</div>
<div class="section" id="salient-factors">
<h2>Salient Factors</h2>
<blockquote>
<div><ul class="simple">
<li>There will often be the requirement for one state transition (Enabler) to enable another state transition (Dependent)</li>
<li>When a Corda node resolves a transaction. It will obtain a copy of the previous Transactions which generated the input states for the current Transaction. It will then recursively resolve the input states on all previous transactions until it has the complete (Directed acyclic) graph required to prove the current transactions input states.</li>
<li>There will often be the requirements to preserve privacy across multiple Enabled transactions.</li>
<li>AssetStates can be fungible, in which case it is the net movement of the asset amount that dictates if the EnabledState transition can occur.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="solution-walkthrough">
<h2>Solution Walkthrough</h2>
<p>State Evolution diagram with Privacy overlay (see the CorDapp Design Language section for details on how to read the diagram):</p>
<a class="reference internal image-reference" href="../../_images/P_Token_receipts_state_evolution.png"><img alt="../../_images/P_Token_receipts_state_evolution.png" class="align-center" src="../../_images/P_Token_receipts_state_evolution.png" style="width: 100%;" /></a>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Steps:</th><td class="field-body"><ol class="first last arabic simple">
<li>An DependentState exists which has the pre-condition ‘PartyA must Pay PartyB £90 with a transferReference ref2’ in its considerationRequired property.</li>
<li>The Contract for the DependentState specifies that the transition ‘DependentCommand’ is not permitted to occur unless the Transaction contains an AssetReceiptState showing that TransferWithReceipt transition has occurred on the AssetState Chain which matches the considerationRequired pre-condition.</li>
<li>A Transaction is constructed using fungible AssetStates where the net movement of AssetStates matches the pre-conditions, using the TransferWithReceipt Command.</li>
<li>As part of the transaction an AssetReceiptState is created. The Contract for the AssetState must ensure that the AssetReceiptState provably matches the transfer that occurred. ie in this case that net movement of £90 of AssetState moved from PartyA to PartyB and that the transferReference was ‘ref2’.</li>
<li>Once the AssetReceiptState has been created, it is used in Transaction 1 to enable the DependentCommand transition on DependentState.</li>
<li>A seconded DependentState exists which has the pre-condition ‘PartyB must Pay PartyC £90 with a transferReference ref3’ in its considerationRequired property.</li>
<li>A second TransferWithReceipt transaction is created, whereby PartyB transfers the Asset he previously receive in transfer ref2 to PartyC, this time the transferReference is ref3. An AssetReceiptState is create.</li>
<li>The AssetReceiptState it is used in Transaction 2 to enable the DependentCommand transition on DependentState.</li>
</ol>
</td>
</tr>
</tbody>
</table>
<p>Note, this mechanism does not guarantee atomicity of the AssetState transition and the DependentState transition.</p>
</div>
<div class="section" id="privacy-analysis">
<h2>Privacy Analysis</h2>
<p>The crux of the pattern is it’s privacy characteristics. There are two important characteristics:</p>
<ol class="arabic simple">
<li>Privacy between DependentState Transactions:</li>
</ol>
<blockquote>
<div>Let’s assume that Transaction 1 is a business deal between Party B and Party A, Transaction 2 is a separate business deal between Party B and PartyC and that PartyC is a competitor of PartyA. Party A should not resolve any details of the PartyB-PartyC deal and PartyC should not resolve any details of the PartyB-PartyA deal. By following the Privacy trace for Party A from Transaction 1 (orange line) you can see that PartyA does not resolve Transaction 2. By following the Privacy trace for PartyC (purple line) from Transaction 2 you can see that PartyC does not resolve Transaction 1.</div></blockquote>
<ol class="arabic simple" start="2">
<li>Privacy from AssetState Participants</li>
</ol>
<blockquote>
<div><p>When the participants on the AssetState chain resolve their Transactions they will only resolve down the AssetState chain, they will never resolve any of the DependentState Transactions which the AssetReceiptStates were used to enable. This is shown by the blue Privacy trace.</p>
<p>This assumes that the participants on the AssetState chain are not participants on the DependentState Transactions, because then they’d get to see the Transaction anyway.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Confidential identities.</li>
</ol>
<blockquote>
<div>In order to avoid Participants on the AssetState chain seeing who owned the AssetState before them, which may leak confidential information, Confidential identities should be used in the AssetStates.</div></blockquote>
</div>
<div class="section" id="extensions-to-investigate">
<h2>Extensions - to investigate</h2>
<blockquote>
<div><ul class="simple">
<li>Timewindows to perform transfer/ other limits on what the EnabledState can do</li>
<li>Pattern could be simplified if the initial asset owner performs a transaction with themselves to create an asset state with the exact amount of asset required, ie removing the need for a ‘change’ state in the asset transfer transaction</li>
<li>Patterns to prevent the spending away of the EnabledState once Payment has been made (asset lock)</li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="receipts.html" class="btn btn-neutral float-left" title="Receipts Pattern" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../antipatterns/antipatterns-overview.html" class="btn btn-neutral float-right" title="CorDapp Anti-Patterns" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, R3 Limited.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>